# üß†üòÇüî• Systemd —Å–µ—Ä–≤—ñ—Å –¥–ª—è —É–∫—Ä–∞—ó–Ω–æ–º–æ–≤–Ω–æ–≥–æ Telegram-–±–æ—Ç–∞ üß†üòÇüî•
#
# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è:
# 1. –°–∫–æ–ø—ñ—é–π—Ç–µ —Ü–µ–π —Ñ–∞–π–ª –¥–æ /etc/systemd/system/ukrainian-bot.service
# 2. sudo systemctl daemon-reload
# 3. sudo systemctl enable ukrainian-bot
# 4. sudo systemctl start ukrainian-bot
#
# –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è:
# sudo systemctl status ukrainian-bot
# sudo systemctl restart ukrainian-bot
# sudo systemctl stop ukrainian-bot
# sudo journalctl -u ukrainian-bot -f

[Unit]
Description=üß†üòÇüî• –£–∫—Ä–∞—ó–Ω–æ–º–æ–≤–Ω–∏–π Telegram-–±–æ—Ç –∑ –º–µ–º–∞–º–∏ —Ç–∞ –∞–Ω–µ–∫–¥–æ—Ç–∞–º–∏
Documentation=https://github.com/yourusername/ukrainian-telegram-bot
After=network-online.target
Wants=network-online.target
Requires=postgresql.service

[Service]
Type=simple
User=botuser
Group=botuser
WorkingDirectory=/opt/ukrainian-bot
Environment=PATH=/opt/ukrainian-bot/venv/bin
ExecStart=/opt/ukrainian-bot/venv/bin/python main.py
ExecReload=/bin/kill -HUP $MAINPID
Restart=always
RestartSec=10
StandardOutput=syslog
StandardError=syslog
SyslogIdentifier=ukrainian-bot

# –ë–µ–∑–ø–µ–∫–∞
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/opt/ukrainian-bot/logs /opt/ukrainian-bot/data /opt/ukrainian-bot/backups
ProtectKernelTunables=true
ProtectKernelModules=true
ProtectControlGroups=true

# –†–µ—Å—É—Ä—Å–∏
LimitNOFILE=65536
LimitNPROC=4096
MemoryMax=1G
CPUQuota=100%

# –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ EnvironmentFile)
Environment=PYTHONPATH=/opt/ukrainian-bot
Environment=PYTHONDONTWRITEBYTECODE=1
Environment=PYTHONUNBUFFERED=1
Environment=LOG_LEVEL=INFO

# –§–∞–π–ª –∑ –∑–º—ñ–Ω–Ω–∏–º–∏ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
EnvironmentFile=-/opt/ukrainian-bot/.env

# Watchdog (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
WatchdogSec=30

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π restart –ø—Ä–∏ –∑–±–æ—è—Ö
RestartPreventExitStatus=SIGKILL
KillMode=mixed
KillSignal=SIGTERM
TimeoutStopSec=30

[Install]
WantedBy=multi-user.target

# ===================================================================
# –î–û–î–ê–¢–ö–û–í–Ü –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–á
# ===================================================================

# –î–ª—è development –≤–µ—Ä—Å—ñ—ó
# [Unit]
# Description=üß†üòÇüî• –£–∫—Ä–∞—ó–Ω–æ–º–æ–≤–Ω–∏–π Telegram-–±–æ—Ç (Development)
# After=network-online.target
# 
# [Service]
# Type=simple
# User=developer
# WorkingDirectory=/home/developer/ukrainian-bot
# ExecStart=/home/developer/ukrainian-bot/venv/bin/python main.py --dev
# Environment=DEBUG=True
# Environment=LOG_LEVEL=DEBUG
# Restart=on-failure
# RestartSec=5
# 
# [Install]
# WantedBy=multi-user.target

# ===================================================================
# –ö–û–ú–ê–ù–î–ò –î–õ–Ø –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø
# ===================================================================

# 1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Å–∏—Å—Ç–µ–º–∏:
# sudo adduser --system --group --home /opt/ukrainian-bot botuser

# 2. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –±–æ—Ç–∞:
# sudo mkdir -p /opt/ukrainian-bot
# sudo chown botuser:botuser /opt/ukrainian-bot
# sudo -u botuser git clone https://github.com/yourusername/ukrainian-bot.git /opt/ukrainian-bot
# cd /opt/ukrainian-bot
# sudo -u botuser python -m venv venv
# sudo -u botuser venv/bin/pip install -r requirements.txt

# 3. –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è:
# sudo -u botuser cp .env.example .env
# sudo -u botuser nano .env

# 4. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π:
# sudo -u botuser mkdir -p /opt/ukrainian-bot/{logs,data,backups}

# 5. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—É:
# sudo cp scripts/ukrainian-bot.service /etc/systemd/system/
# sudo systemctl daemon-reload
# sudo systemctl enable ukrainian-bot

# 6. –ó–∞–ø—É—Å–∫:
# sudo systemctl start ukrainian-bot

# 7. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É:
# sudo systemctl status ukrainian-bot
# sudo journalctl -u ukrainian-bot -f

# 8. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ backup (–¥–æ–¥–∞—Ç–∏ –¥–æ crontab):
# 0 2 * * * /opt/ukrainian-bot/venv/bin/python /opt/ukrainian-bot/scripts/backup.py create

# 9. –†–æ—Ç–∞—Ü—ñ—è –ª–æ–≥—ñ–≤ (/etc/logrotate.d/ukrainian-bot):
# /opt/ukrainian-bot/logs/*.log {
#     daily
#     rotate 30
#     compress
#     delaycompress
#     missingok
#     notifempty
#     copytruncate
#     su botuser botuser
# }