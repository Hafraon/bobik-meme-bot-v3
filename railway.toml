# üß†üòÇüî• Railway –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –¥–ª—è deployment üß†üòÇüî•

[build]
builder = "nixpacks"
buildCommand = "pip install -r requirements.txt"

[deploy]
startCommand = "python main.py"
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "on-failure"
restartPolicyMaxRetries = 3

# –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (–¥–æ–¥–∞–π—Ç–µ —á–µ—Ä–µ–∑ Railway UI)
[deploy.env]
PYTHONPATH = "/app"
PYTHONDONTWRITEBYTECODE = "1"
PYTHONUNBUFFERED = "1"
LOG_LEVEL = "INFO"
TIMEZONE = "Europe/Kiev"

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤
[deploy.resources]
memoryLimit = "512Mi"
cpuLimit = "0.5"

# –ü–æ—Ä—Ç –¥–ª—è HTTP —Å–µ—Ä–≤–µ—Ä–∞
[[deploy.ports]]
port = 8080
protocol = "http"

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è auto-scaling
[deploy.scaling]
minReplicas = 1
maxReplicas = 2
targetCPUUtilization = 80
targetMemoryUtilization = 80

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É
[deploy.monitoring]
enabled = true
healthcheck = true
metrics = true

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è
[deploy.logging]
level = "info"
format = "json"
retention = "7d"

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è backup (—è–∫—â–æ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è)
[deploy.backup]
enabled = true
schedule = "0 2 * * *"  # –©–æ–¥–Ω—è –æ 2:00
retention = "30d"

# –°—Ü–µ–Ω–∞—Ä—ñ—ó –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â
[environments.production]
build.buildCommand = "pip install --no-cache-dir -r requirements.txt"
deploy.env.DEBUG = "False"
deploy.env.LOG_LEVEL = "WARNING"
deploy.resources.memoryLimit = "1Gi"
deploy.resources.cpuLimit = "1.0"

[environments.staging]
deploy.env.DEBUG = "True"
deploy.env.LOG_LEVEL = "DEBUG"
deploy.resources.memoryLimit = "256Mi"
deploy.resources.cpuLimit = "0.25"

[environments.development]
deploy.env.DEBUG = "True"
deploy.env.LOG_LEVEL = "DEBUG"
deploy.startCommand = "python main.py --dev"

# –°–µ—Ä–≤—ñ—Å–∏ (–±–∞–∑–∏ –¥–∞–Ω–∏—Ö, Redis —Ç–æ—â–æ)
[[services]]
name = "postgres"
type = "postgresql"
version = "15"
plan = "hobby"

[[services]]
name = "redis"
type = "redis"
version = "7"
plan = "hobby"

# Domains —Ç–∞ SSL
[[domains]]
domain = "your-bot-domain.railway.app"
ssl = true

# Webhooks –¥–ª—è CI/CD
[[webhooks]]
url = "https://api.github.com/repos/yourusername/repo/dispatches"
events = ["deploy.success", "deploy.failure"]
secret = "$GITHUB_WEBHOOK_SECRET"

# Cron jobs –¥–ª—è –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫–∞
[[cron]]
name = "daily-cleanup"
schedule = "0 2 * * *"
command = "python scripts/cleanup.py"

[[cron]]
name = "weekly-backup"
schedule = "0 3 * * 0"
command = "python scripts/backup.py create"

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏
[security]
allowedIPs = []  # –ü–æ—Ä–æ–∂–Ω—ñ–π —Å–ø–∏—Å–æ–∫ = –≤—Å—ñ IP –¥–æ–∑–≤–æ–ª–µ–Ω—ñ
enableCSP = true
enableHSTS = true

# –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó
[integrations.sentry]
enabled = true
dsn = "$SENTRY_DSN"
environment = "$RAILWAY_ENVIRONMENT"

[integrations.prometheus]
enabled = true
endpoint = "/metrics"

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –º–µ—Ä–µ–∂—ñ
[network]
subdomain = "ukrainian-bot"
customDomain = ""

# Build –∫–µ—à
[build.cache]
enabled = true
paths = [
    "~/.cache/pip",
    "node_modules",
    "__pycache__"
]

# –°–µ–∫—Ä–µ—Ç–∏ (–Ω–∞–ª–∞—à—Ç–æ–≤—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ Railway UI)
# BOT_TOKEN - Telegram Bot Token
# ADMIN_ID - ID –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
# DATABASE_URL - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥ PostgreSQL —Å–µ—Ä–≤—ñ—Å—É
# REDIS_URL - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥ Redis —Å–µ—Ä–≤—ñ—Å—É
# OPENAI_API_KEY - –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è AI —Ñ—É–Ω–∫—Ü—ñ–π
# SECRET_KEY - –¥–ª—è –ø—ñ–¥–ø–∏—Å—É –¥–∞–Ω–∏—Ö
# SENTRY_DSN - –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –ø–æ–º–∏–ª–æ–∫

# –ö–æ–º–∞–Ω–¥–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è
[scripts]
start = "python main.py"
test = "python -m pytest"
lint = "flake8 ."
format = "black ."
migrate = "alembic upgrade head"
backup = "python scripts/backup.py create"
restore = "python scripts/backup.py restore"

# –ú–µ—Ç–∞–¥–∞–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É
[project]
name = "ukrainian-telegram-bot"
description = "–£–∫—Ä–∞—ó–Ω–æ–º–æ–≤–Ω–∏–π Telegram-–±–æ—Ç –∑ –º–µ–º–∞–º–∏ —Ç–∞ –∞–Ω–µ–∫–¥–æ—Ç–∞–º–∏"
version = "1.0.0"
author = "Your Name <your.email@example.com>"
license = "MIT"
repository = "https://github.com/yourusername/ukrainian-telegram-bot"
homepage = "https://your-bot-domain.railway.app"

# Railway —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
[railway]
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏ push –¥–æ main
autodeploy = true
branch = "main"

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±—ñ–ª–¥–µ—Ä–∞
nixpacks = true

# –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Railway CLI –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ—ó —Ä–æ–∑—Ä–æ–±–∫–∏
localDevelopment = true

# –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –≤–∏–º–æ–≥–∏
minMemory = "256Mi"
minCPU = "0.1"

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ä–µ–≥—ñ–æ–Ω—É (–Ω–∞–±–ª–∏–∂–µ–Ω–∏–π –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤)
region = "eu-west-1"  # –Ñ–≤—Ä–æ–ø–∞ –¥–ª—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—ó –∞—É–¥–∏—Ç–æ—Ä—ñ—ó